<!-- =========================================================
     FR : Tableau de bord principal
     EN : Main Dashboard page
     ========================================================= -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />

  <!-- FR : Titre de la page / EN : Page title -->
  <title>Tableau de bord â€” Port Russell</title>

  <!-- FR : Feuille de style principale / EN : Main stylesheet -->
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <!-- =========================================================
       FR : En-tÃªte (Header)
       EN : Header (Top bar)
       ========================================================= -->
  <header class="topbar">
    <nav class="nav">
      <!-- Liens de navigation principaux -->
      <a href="/">Accueil</a> <!-- FR : Retour accueil / EN : Back to home -->
      <a href="/dashboard">Tableau de bord</a> <!-- FR : Page actuelle / EN : Current dashboard page -->
      <a href="/docs" target="_blank" rel="noreferrer">Docs API (Swagger)</a> <!-- FR : Lien vers la documentation API / EN : Link to API docs -->

      <!-- FR : Espace flexible pour pousser la zone utilisateur Ã  droite
           EN : Spacer pushes the user info and logout button to the right -->
      <div class="nav-spacer"></div>

      <!-- FR : Zone utilisateur connectÃ©e / EN : Logged-in user area -->
      <span class="nav-user">
        <%= userEmail ? `ConnectÃ© : ${userEmail}` : 'ConnectÃ© : invitÃ©' %>
      </span>

      <!-- FR : Bouton de dÃ©connexion / EN : Logout button -->
      <a class="btn-logout" href="/logout">Se dÃ©connecter</a>
    </nav>
  </header>

  <!-- =========================================================
       FR : Contenu principal du tableau de bord
       EN : Main dashboard content
       ========================================================= -->
  <main class="dashboard-main">
    <h1 class="dash-title">Tableau de bord</h1>

    <!-- =========================================================
         FR : Disposition en grille (rÃ©sumÃ© + menu + tableau)
         EN : Grid layout (summary + quick menu + table)
         ========================================================= -->
    <section class="dash-grid">

      <!-- =======================
           FR : Bloc rÃ©sumÃ©
           EN : Summary card
           ======================= -->
      <div class="dash-card">
        <h2>RÃ©sumÃ©</h2>

        <!-- FR : Date et heure actuelles / EN : Current date and time -->
        <p class="dash-date">
          <% const d = new Date(today); %>
          <%= new Intl.DateTimeFormat('fr-FR', { dateStyle:'full', timeStyle:'short' }).format(d) %>
        </p>

        <p class="dash-muted">
          Bienvenue sur le systÃ¨me de gestion des catways et rÃ©servations.
          <!-- EN : Welcome message -->
        </p>

        <p>
          <strong>RÃ©servations en cours :</strong>
          <span class="pill"><%= countCurrent %></span>
          <!-- FR : Compteur dynamique des rÃ©servations actives -->
          <!-- EN : Dynamic counter of active reservations -->
        </p>
      </div>

      <!-- =======================
           FR : Bloc menu rapide
           EN : Quick access menu card
           ======================= -->
      <div class="dash-card">
        <h2>Menu rapide</h2>
        <ul class="quick-links">
          <li>ğŸ› ï¸ <a class="link-quiet" href="/ui/catways">GÃ©rer les Catways</a></li>
          <li>ğŸ“… <a class="link-quiet" href="/ui/reservations">GÃ©rer les RÃ©servations</a></li>
          <li>ğŸ‘¤ <a class="link-quiet" href="/ui/users">GÃ©rer les Utilisateurs</a></li>
          <li>ğŸ“š <a class="link-quiet" href="/docs" target="_blank" rel="noreferrer">Documentation API</a></li>
        </ul>
      </div>

      <!-- =======================
           FR : Bloc tableau des rÃ©servations en cours
           EN : Current reservations table card
           ======================= -->
      <div class="dash-card dash-span-2">
        <h2>RÃ©servations en cours</h2>

        <!-- FR : Si aucune rÃ©servation active / EN : If no active reservations -->
        <% if (!currentReservations || currentReservations.length === 0) { %>
          <p class="dash-muted">Aucune rÃ©servation en cours.</p>

        <% } else { %>
          <!-- FR : Sinon, afficher le tableau des rÃ©servations / EN : Otherwise display table -->
          <div class="table-wrapper">
            <table class="dash-table">
              <thead>
                <tr>
                  <th>Catway</th>
                  <th>Client</th>
                  <th>Bateau</th>
                  <th>DÃ©but</th>
                  <th>Fin</th>
                </tr>
              </thead>

              <tbody>
              <% currentReservations.forEach(r => { %>
                <tr>
                  <td><%= r.catwayNumber %></td>
                  <td><%= r.clientName %></td>
                  <td><%= r.boatName %></td>

                  <!-- FR : Dates formatÃ©es proprement en franÃ§ais
                       EN : Nicely formatted French dates -->
                  <td><%= new Intl.DateTimeFormat('fr-FR', { dateStyle:'medium' }).format(new Date(r.startDate)) %></td>
                  <td><%= new Intl.DateTimeFormat('fr-FR', { dateStyle:'medium' }).format(new Date(r.endDate)) %></td>
                </tr>
              <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </section>
  </main>
</body>
</html>
