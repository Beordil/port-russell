<!-- =========================================================
     FR : Tableau de bord principal
     EN : Main Dashboard page
     ========================================================= -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />

  <!-- FR : Titre de la page / EN : Page title -->
  <title>Tableau de bord — Port Russell</title>

  <!-- FR : Feuille de style principale / EN : Main stylesheet -->
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <!-- =========================================================
       FR : En-tête (Header)
       EN : Header (Top bar)
       ========================================================= -->
  <header class="topbar">
    <nav class="nav">
      <!-- Liens de navigation principaux -->
      <a href="/">Accueil</a> <!-- FR : Retour accueil / EN : Back to home -->
      <a href="/dashboard">Tableau de bord</a> <!-- FR : Page actuelle / EN : Current dashboard page -->
      <a href="/docs" target="_blank" rel="noreferrer">Docs API (Swagger)</a> <!-- FR : Lien vers la documentation API / EN : Link to API docs -->

      <!-- FR : Espace flexible pour pousser la zone utilisateur à droite
           EN : Spacer pushes the user info and logout button to the right -->
      <div class="nav-spacer"></div>

      <!-- FR : Zone utilisateur connectée / EN : Logged-in user area -->
      <span class="nav-user">
        <%= userEmail ? `Connecté : ${userEmail}` : 'Connecté : invité' %>
      </span>

      <!-- FR : Bouton de déconnexion / EN : Logout button -->
      <a class="btn-logout" href="/logout">Se déconnecter</a>
    </nav>
  </header>

  <!-- =========================================================
       FR : Contenu principal du tableau de bord
       EN : Main dashboard content
       ========================================================= -->
  <main class="dashboard-main">
    <h1 class="dash-title">Tableau de bord</h1>

    <!-- =========================================================
         FR : Disposition en grille (résumé + menu + tableau)
         EN : Grid layout (summary + quick menu + table)
         ========================================================= -->
    <section class="dash-grid">

      <!-- =======================
           FR : Bloc résumé
           EN : Summary card
           ======================= -->
      <div class="dash-card">
        <h2>Résumé</h2>

        <!-- FR : Date et heure actuelles / EN : Current date and time -->
        <p class="dash-date">
          <% const d = new Date(today); %>
          <%= new Intl.DateTimeFormat('fr-FR', { dateStyle:'full', timeStyle:'short' }).format(d) %>
        </p>

        <p class="dash-muted">
          Bienvenue sur le système de gestion des catways et réservations.
          <!-- EN : Welcome message -->
        </p>

        <p>
          <strong>Réservations en cours :</strong>
          <span class="pill"><%= countCurrent %></span>
          <!-- FR : Compteur dynamique des réservations actives -->
          <!-- EN : Dynamic counter of active reservations -->
        </p>
      </div>

      <!-- =======================
           FR : Bloc menu rapide
           EN : Quick access menu card
           ======================= -->
      <div class="dash-card">
        <h2>Menu rapide</h2>
        <ul class="quick-links">
          <li>🛠️ <a class="link-quiet" href="/ui/catways">Gérer les Catways</a></li>
          <li>📅 <a class="link-quiet" href="/ui/reservations">Gérer les Réservations</a></li>
          <li>👤 <a class="link-quiet" href="/ui/users">Gérer les Utilisateurs</a></li>
          <li>📚 <a class="link-quiet" href="/docs" target="_blank" rel="noreferrer">Documentation API</a></li>
        </ul>
      </div>

      <!-- =======================
           FR : Bloc tableau des réservations en cours
           EN : Current reservations table card
           ======================= -->
      <div class="dash-card dash-span-2">
        <h2>Réservations en cours</h2>

        <!-- FR : Si aucune réservation active / EN : If no active reservations -->
        <% if (!currentReservations || currentReservations.length === 0) { %>
          <p class="dash-muted">Aucune réservation en cours.</p>

        <% } else { %>
          <!-- FR : Sinon, afficher le tableau des réservations / EN : Otherwise display table -->
          <div class="table-wrapper">
            <table class="dash-table">
              <thead>
                <tr>
                  <th>Catway</th>
                  <th>Client</th>
                  <th>Bateau</th>
                  <th>Début</th>
                  <th>Fin</th>
                </tr>
              </thead>

              <tbody>
              <% currentReservations.forEach(r => { %>
                <tr>
                  <td><%= r.catwayNumber %></td>
                  <td><%= r.clientName %></td>
                  <td><%= r.boatName %></td>

                  <!-- FR : Dates formatées proprement en français
                       EN : Nicely formatted French dates -->
                  <td><%= new Intl.DateTimeFormat('fr-FR', { dateStyle:'medium' }).format(new Date(r.startDate)) %></td>
                  <td><%= new Intl.DateTimeFormat('fr-FR', { dateStyle:'medium' }).format(new Date(r.endDate)) %></td>
                </tr>
              <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </section>
  </main>
</body>
</html>
